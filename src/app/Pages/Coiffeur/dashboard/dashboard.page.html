<ion-header>
  <ion-toolbar>
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <h2 class="ion-padding">📊 Activité</h2>

  <ion-card class="ion-padding stats-card">
    <div class="stats-grid">
      <div class="stat-item">
        <h3>Total RDV</h3>
        <p class="stat-number">{{stats.total}}</p>
      </div>
      <div class="stat-item">
        <h3>Terminés</h3>
        <p class="stat-number success">{{stats.finished}}</p>
      </div>
      <div class="stat-item">
        <h3>Annulés</h3>
        <p class="stat-number danger">{{stats.canceled}}</p>
      </div>
    </div>
    
    <div class="chart-container">
      <canvas id="pieChart"></canvas>
    </div>
  </ion-card>

  <h2 class="ion-padding">📆 Futurs rendez-vous</h2>

  <ng-container *ngIf="appointments.length > 0; else noAppointments">
    <ng-container *ngFor="let rdv of appointments">
      <ion-card class="ion-padding nxtrdv" *ngIf="rdv.statut !== 'finished'">
        <h2>{{rdv.nomCompletClient}}</h2>
        <p>💵 {{rdv.tarif}}</p>
        <h2 class="date">{{formatDate(rdv.date)}}, {{rdv.heure}}</h2>
        
        <ng-container *ngIf="rdv.statut === 'canceled'; else showAddress">
          <h2 class="canceled-text" color="danger">Annulé</h2>
          <ion-button color="medium" (click)="deleteAppointment(rdv.id)">D'accord</ion-button>
        </ng-container>
        
        <ng-template #showAddress>
          <h2>📍 {{rdv.adresse}}</h2>
          <ion-button 
            *ngIf="isAppointmentPast(rdv.date, rdv.heure) && rdv.statut !== 'canceled'"
            expand="block"
            class="black-button"
            (click)="markAsFinished(rdv.id)">
            Terminé
          </ion-button>
        </ng-template>
      </ion-card>
    </ng-container>
  </ng-container>

  <ng-template #noAppointments>
    <ion-card class="ion-padding">
      <p>Vous n'avez pas de rendez-vous pour le moment.</p>
    </ion-card>
  </ng-template>

</ion-content>
